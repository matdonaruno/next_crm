# ダミーJANコード採番手法

## 概要

本システムでは、JANコードが存在しない商品に対して、一意に識別可能なダミーのJANコードを自動生成しています。
このドキュメントでは、その採番手法と実装方法について詳細に説明します。

## 採番手法

ダミーJANコードは以下の3つの要素から構成されています：

### 1. プレフィックス: 0999

- 実在しないJANコードの接頭辞として「0999」を使用
- このプレフィックスで始まるコードは架空のJANコードであることを示す
- 実際のJANコード（GTIN-14）では、先頭の桁は包装レベルを示す「包装インジケータ」であり、通常は0〜8の値が使用される
- 国際的に管理されているGS1プレフィックスと衝突しないよう設計

### 2. シーケンス番号: 10桁の連番

- 1000000から始まる連番を使用
- 各商品に一意のコードを割り当てるため
- 10桁の長さを確保することで、最大10,000,000個のユニークなコードを生成可能
- 数値は左側をゼロパディングして常に10桁を維持

### 3. チェックディジット: 1桁

- 実際のJANコード（GTIN-14）と同様の計算方法でチェックディジットを算出
- 計算方法：
  1. 左から順に、奇数桁の数字はそのまま、偶数桁の数字は3倍して合計
  2. その合計を10で割った余りを10から引いた値
  3. 結果が10の場合は0とする

## 実装例

```typescript
// 架空のJANコードのプレフィックス
const fakeJanPrefix = "0999";
let fakeJanCounter = 1000000;

// 架空のJANコードを生成（14桁）
const fakeJanBase = fakeJanPrefix + String(fakeJanCounter++).padStart(10, '0');

// チェックディジットを計算
let sum = 0;
for (let i = 0; i < 13; i++) {
  const digit = parseInt(fakeJanBase[i]);
  sum += i % 2 === 0 ? digit : digit * 3;
}
const checkDigit = (10 - (sum % 10)) % 10;

// 架空のJANコードを設定（プレフィックス + カウンター + チェックディジット）
const fakeJanCode = fakeJanBase.slice(0, 13) + checkDigit;
```

## 生成例

| 元のデータ | 生成されたダミーJANコード | 説明 |
|------------|--------------------------|------|
| なし       | 09991000000X             | 最初に生成されたダミーコード |
| なし       | 09991000001Y             | 2番目に生成されたダミーコード |
| なし       | 09991000002Z             | 3番目に生成されたダミーコード |

※ X, Y, Zはチェックディジットを表す（実際の値は計算によって決まる）

## 注意事項

1. このコードは実在するJANコードと衝突しないように設計されていますが、将来的にGS1の割り当てが変更される可能性があります。
2. システム内部での使用を前提としており、実際の商品流通では使用できません。
3. バーコードスキャナーでの読み取りは可能ですが、外部システムでの認識は保証されません。
4. 将来的にコードの枯渇を避けるため、必要に応じてプレフィックスやカウンターの範囲を拡張することを検討してください。

## 実装箇所

ダミーJANコードの生成ロジックは以下のファイルに実装されています：

- `src/app/reagent/register/page.tsx` - `fetchProducts` 関数内

## 更新履歴

- 2023-11-15: 初版作成
- 2023-11-16: ダミーJANコードの生成ロジックを実装 